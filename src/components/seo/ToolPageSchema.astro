---
interface Props {
  title: string;
  description: string;
  url: string;
  slug: string;
  publishedAt?: string;
  updatedAt?: string;
  faqs?: { q: string; a: string }[];
  howToSteps?: { name: string; text: string }[];
  applicationCategory?: string;
  featureList?: string[];
  relatedUrls?: string[];
}

const { title, description, url, slug, publishedAt, updatedAt, faqs = [], howToSteps = [], applicationCategory = 'FinanceApplication', featureList = ['Calculator', 'Charts', 'Export'], relatedUrls = [] } = Astro.props;

const siteUrl = 'https://jumpstartscaling.com';

const breadcrumb = {
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: siteUrl },
    { '@type': 'ListItem', position: 2, name: 'Tools', item: `${siteUrl}/tools` },
    { '@type': 'ListItem', position: 3, name: title, item: url },
  ],
};

const webPage = {
  '@type': 'WebPage',
  '@id': `${url}#webpage`,
  name: title,
  description,
  url,
  datePublished: publishedAt || undefined,
  dateModified: updatedAt || publishedAt || undefined,
  breadcrumb,
  speakable: {
    '@type': 'SpeakableSpecification',
    cssSelector: ['h1', '.hero-intro', '.key-takeaway', '.faq-answer'],
  },
  publisher: { '@id': `${siteUrl}/#organization` },
};

const softwareApp = {
  '@type': 'WebApplication',
  name: title,
  description,
  applicationCategory,
  featureList,
  operatingSystem: 'Any',
  url,
  offers: { '@type': 'Offer', price: '0', priceCurrency: 'USD' },
};

const faqSchema = faqs.length > 0 ? {
  '@type': 'FAQPage',
  mainEntity: faqs.map((f) => ({
    '@type': 'Question',
    name: f.q,
    acceptedAnswer: { '@type': 'Answer', text: f.a },
  })),
} : null;

const howToSchema = howToSteps.length > 0 ? {
  '@type': 'HowTo',
  name: `How to use ${title}`,
  step: howToSteps.map((s, i) => ({
    '@type': 'HowToStep',
    position: i + 1,
    name: s.name,
    text: s.text,
  })),
  totalTime: 'PT2M',
} : null;

const itemListSchema = relatedUrls.length > 0 ? {
  '@type': 'ItemList',
  itemListElement: relatedUrls.map((u, i) => ({
    '@type': 'ListItem',
    position: i + 1,
    url: u.startsWith('http') ? u : new URL(u, siteUrl).href,
  })),
} : null;
---
<script type="application/ld+json" set:html={JSON.stringify({ '@context': 'https://schema.org', '@graph': [breadcrumb, webPage, softwareApp, ...(faqSchema ? [faqSchema] : []), ...(howToSchema ? [howToSchema] : []), ...(itemListSchema ? [itemListSchema] : [])] })} />
