---
import AtmosphereParticles from '../visuals/AtmosphereParticles.astro';
---
<section class="relative overflow-hidden min-h-[60vh] flex items-center justify-center py-20">
  <div class="absolute inset-0 -z-10 bg-[var(--bg)]">
    <AtmosphereParticles />
  </div>
  <div class="w-full text-center parallax-content relative z-10">
    <slot />
  </div>
  <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-[var(--bg)] to-transparent pointer-events-none"></div>
</section>
<style>
  .parallax-content { will-change: transform; transition: opacity 0.1s; }
</style>
<script>
  function updateParallax() {
    const scroll = window.scrollY;
    // Select all parallax contents to be safe
    const heroes = document.querySelectorAll('.parallax-content');
    heroes.forEach(hero => {
       (hero as HTMLElement).style.transform = `translateY(${scroll * 0.3}px)`;
       (hero as HTMLElement).style.opacity = (1 - scroll / 500).toString();
    });
  }

  document.addEventListener('astro:page-load', () => {
    window.addEventListener('scroll', updateParallax, { passive: true });
  });
  
  document.addEventListener('astro:before-preparation', () => {
    window.removeEventListener('scroll', updateParallax);
  });
</script>
